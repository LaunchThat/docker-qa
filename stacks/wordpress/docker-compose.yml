version: '2'
services:
  mysql:
    image: 'mysql:5.7.24'
    environment:
      - MYSQL_ROOT_PASSWORD=${DB_ROOT_PW}
      - MYSQL_DATABASE=${DB_WP_DB}
      - MYSQL_USER=${DB_WP_USER}
      - MYSQL_PASSWORD=${DB_WP_PW}
    volumes:
      - db:/var/lib/mysql

  memcached:
    image: memcached

  wordpress:
    image: 'ltdcox/wordpress:ubuntu1804'
    ports:
      - ${WP_PORT}:80
    environment:
      - WORDPRESS_DB_HOST=mysql:3306
      - WORDPRESS_DB_USER=${WP_DB_USER}
      - WORDPRESS_DB_PASSWORD=${DB_WP_PW}
      - WORDPRESS_SITEURL=${DOCKER_HOST}:${WP_PORT}
    depends_on:
      gitnode:
        condition: service_healthy

  gitnode:
    image: 'ltdcox/gitnode'
    environment:
      - GITHUB_ORG=org
      - GITHUB_REPO=repo
      - GITHUB_BRANCH=branch
      - GITHUB_NAME=John Doe
      - GITHUB_EMAIL=email
    healthcheck:
      test: "exit 0"
    depends_on:
      - mysql
